\usepackage{amsmath}
\usepackage{amsthm}

%% Mathpartir

\usepackage{mathpartir}

\newcommand{\mathparinit}{
% spacing below and above mathpar blocks
\abovedisplayskip .5em
\belowdisplayskip .5em
}
\newcommand{\Rule}[1]{\hyperlink{#1}{\TirName {#1}}}
\renewcommand{\DefTirName}[1]{\hypertarget{#1}{\TirName {#1}}}

\newtheorem*{notation}{Notation}

\newtheorem{fact}{Fact}

\newenvironment{remark}
   {\paragraph{Remark}}
   {}

% This looks like a space hack, but it's not! The point
% is to remove a visually-ugly stacking of spacings coming
% from the figure and the math environment.
\newenvironment{mathparfig}[3][htb!]
   {\begin{figure}[#1]
       \abovedisplayskip 0em
       \belowdisplayskip 0em
       \def \LABEL{#2}
       \def \CAPTION{#3}
       \begin{mathpar}}
       {\end{mathpar}
       \caption{\CAPTION}
       \label{\LABEL}
     \end{figure}}

%% \newenvironment{mathline}
%%    {\abovedisplayskip 0.1em
%%     \belowdisplayskip 0.1em
%%     \begin{mathpar}}
%%    {\end{mathpar}}

%% Arrays and tabular
\usepackage{array}

\newcolumntype{L}{>{${}}l<{{}$}}
\newcolumntype{R}{>{${}}r<{{}$}}
\newcolumntype{C}{>{${}}c<{{}$}}

\newcolumntype{.}{@{}}
\newcolumntype{+}{@{\qquad}}
\newcolumntype{;}{@{\;}}
\newcolumntype{,}{@{\,}}

\newcolumntype{~}{@{\extracolsep{\fill}}}
\newcolumntype{=}{@{\extracolsep{0em}}}
\newcolumntype{Z}{~c=}

\newcommand {\emath}[1]{\ensuremath{#1}}

\newcommand {\bnf@emptyentry}[2][]
  {\bnf@flushentry \gdef\@bnf@entry {&&#1}
   & #2&&\bnf@flushentry}
\newcommand {\bnf@entry}[3][]
  {\bnf@flushentry \gdef\@bnf@entry {&&#1}
   & #2&\ifempty{#2}{}{\ifempty{#3}{}{\bnf@is}}& #3\bnf@flushentry}
\def \bnf@empty{\gdef \@bnf@entry{}}\bnf@empty
\def \bnf@is {::=}
\def \bnf@mid {\mid}
\def \bnf@flushentry{\@bnf@entry \bnf@empty}
\def \bnf@andcr{\bnf@flushentry \\&&\bnf@mid&}
\def \bnf@nextline #1{\bnf@andcr \ifthenelse {\equal{#1}{\bnf@mid}}{}{#1}}

\newenvironment{bnfgrammar}[1][]
  {\let \entry \bnf@entry
   \let \is \bnf@is
   \let \and \bnf@mid
   \let \andcr \bnf@andcr
   \let \And \bnf@andcr
   \let \nextline \bnf@nextline
   #1\relax
   \begin{tabular*}{\linewidth}{.C~R=;;R;;LL~r.}}
 {\end{tabular*}}

\newcommand{\Defined}{\downarrow\mathclose{}}
\newcommand{\Undefined}{\uparrow\mathclose{}}

\newenvironment{bnffig}[3][htb!]
  {\begin{mathparfig}[#1]{#2}{#3}\begin{bnfgrammar}}
  {\end{bnfgrammar}\end{mathparfig}}

\newcommand{\proofcase}[2][Case]{\par\smallskip\noindent\emph{#1 #2.}}
